name: Check PR

on:
  pull_request:
    branches:
      - main
    paths-ignore:
      - README.md
      - ci/**
      - .github/**

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Get version from file
        id: get_version
        run: echo "version=$(cat VERSION)" >> $GITHUB_OUTPUT
      - name: 'Get Previous tag'
        id: previoustag
        uses: "WyriHaximus/github-action-get-previous-tag@v1.4.0"
      - name: Checking for version bump
        id: check_vbump
        run: |
          LAST_TAG="${{ steps.previoustag.outputs.tag }}"
          NEW_TAG="v${{ steps.get_version.outputs.version }}"
          RESULT=$(ci/assets/checksemver.sh ${NEW_TAG} ${LAST_TAG})
          if [ "${RESULT}" == "1" ]; then
            echo "msg=Version bump found." >> $GITHUB_OUTPUT
            exit 0
          elif [ "${RESULT}" == "0" ]; then
            echo "msg=Version bump did not happen. ${LAST_TAG} is the same as ${NEW_TAG}" >> $GITHUB_OUTPUT
            exit 1
          else
            echo "msg=Version bump did not happen. ${LAST_TAG} is higher than ${NEW_TAG}" >> $GITHUB_OUTPUT
            exit 1
          fi
      - uses: mshick/add-pr-comment@v2.8.2
        if: always()
        with:
          message: |
            ${{ steps.check_vbump.outputs.msg }}